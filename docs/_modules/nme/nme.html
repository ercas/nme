
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>nme.nme &#8212; NICE Lab Molecule Editor  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for nme.nme</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. |xyz| replace:: A tuple, list, or numpy array of size 3</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">scipy.spatial</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Default threshold distance, in angstroms, for a bond between two atoms</span>
<span class="n">DEFAULT_BOND_RADIUS</span> <span class="o">=</span> <span class="mf">1.8</span>

<span class="c1"># Periodic Table (parsed from http://periodic.lanl.gov/index.shtml)</span>
<span class="n">ELEMENTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kc">None</span><span class="p">,</span> <span class="c1"># no 0th element</span>
    <span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">,</span>  <span class="mf">1.008</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;He&quot;</span><span class="p">,</span> <span class="mf">4.003</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Li&quot;</span><span class="p">,</span> <span class="mf">6.94</span><span class="p">),</span>   <span class="p">(</span><span class="s2">&quot;Be&quot;</span><span class="p">,</span> <span class="mf">9.012</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span>  <span class="mf">10.81</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span>  <span class="mf">12.01</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span>  <span class="mf">14.01</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span>  <span class="mf">16.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>  <span class="mf">19.0</span><span class="p">),</span>   <span class="p">(</span><span class="s2">&quot;Ne&quot;</span><span class="p">,</span> <span class="mf">20.18</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Na&quot;</span><span class="p">,</span> <span class="mf">22.99</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Mg&quot;</span><span class="p">,</span> <span class="mf">24.31</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Al&quot;</span><span class="p">,</span> <span class="mf">26.98</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="mf">28.09</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span>  <span class="mf">30.97</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span>  <span class="mf">32.06</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Cl&quot;</span><span class="p">,</span> <span class="mf">35.45</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ar&quot;</span><span class="p">,</span> <span class="mf">39.95</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span>  <span class="mf">39.1</span><span class="p">),</span>   <span class="p">(</span><span class="s2">&quot;Ca&quot;</span><span class="p">,</span> <span class="mf">40.08</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Sc&quot;</span><span class="p">,</span> <span class="mf">44.96</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ti&quot;</span><span class="p">,</span> <span class="mf">47.88</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span>  <span class="mf">50.94</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Cr&quot;</span><span class="p">,</span> <span class="mf">52.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Mn&quot;</span><span class="p">,</span> <span class="mf">54.94</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Fe&quot;</span><span class="p">,</span> <span class="mf">55.85</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Co&quot;</span><span class="p">,</span> <span class="mf">58.93</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ni&quot;</span><span class="p">,</span> <span class="mf">58.69</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Cu&quot;</span><span class="p">,</span> <span class="mf">63.55</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Zn&quot;</span><span class="p">,</span> <span class="mf">65.39</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ga&quot;</span><span class="p">,</span> <span class="mf">69.72</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ge&quot;</span><span class="p">,</span> <span class="mf">72.64</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;As&quot;</span><span class="p">,</span> <span class="mf">74.92</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Se&quot;</span><span class="p">,</span> <span class="mf">78.96</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Br&quot;</span><span class="p">,</span> <span class="mf">79.9</span><span class="p">),</span>   <span class="p">(</span><span class="s2">&quot;Kr&quot;</span><span class="p">,</span> <span class="mf">83.79</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Rb&quot;</span><span class="p">,</span> <span class="mf">85.47</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Sr&quot;</span><span class="p">,</span> <span class="mf">87.62</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span>  <span class="mf">88.91</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Zr&quot;</span><span class="p">,</span> <span class="mf">91.22</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Nb&quot;</span><span class="p">,</span> <span class="mf">92.91</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Mo&quot;</span><span class="p">,</span> <span class="mf">95.96</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Tc&quot;</span><span class="p">,</span> <span class="mf">98.0</span><span class="p">),</span>   <span class="p">(</span><span class="s2">&quot;Ru&quot;</span><span class="p">,</span> <span class="mf">101.1</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Rh&quot;</span><span class="p">,</span> <span class="mf">102.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Pd&quot;</span><span class="p">,</span> <span class="mf">106.4</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="mf">107.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Cd&quot;</span><span class="p">,</span> <span class="mf">112.4</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;In&quot;</span><span class="p">,</span> <span class="mf">114.8</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Sn&quot;</span><span class="p">,</span> <span class="mf">118.7</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Sb&quot;</span><span class="p">,</span> <span class="mf">121.8</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Te&quot;</span><span class="p">,</span> <span class="mf">127.6</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span>  <span class="mf">126.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Xe&quot;</span><span class="p">,</span> <span class="mf">131.3</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Cs&quot;</span><span class="p">,</span> <span class="mf">132.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="mf">137.3</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;La&quot;</span><span class="p">,</span> <span class="mf">138.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ce&quot;</span><span class="p">,</span> <span class="mf">140.1</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Pr&quot;</span><span class="p">,</span> <span class="mf">140.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Nd&quot;</span><span class="p">,</span> <span class="mf">144.2</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Pm&quot;</span><span class="p">,</span> <span class="mf">145.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Sm&quot;</span><span class="p">,</span> <span class="mf">150.4</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Eu&quot;</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Gd&quot;</span><span class="p">,</span> <span class="mf">157.2</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Tb&quot;</span><span class="p">,</span> <span class="mf">158.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Dy&quot;</span><span class="p">,</span> <span class="mf">162.5</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ho&quot;</span><span class="p">,</span> <span class="mf">164.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Er&quot;</span><span class="p">,</span> <span class="mf">167.3</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Tm&quot;</span><span class="p">,</span> <span class="mf">168.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Yb&quot;</span><span class="p">,</span> <span class="mf">173.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Lu&quot;</span><span class="p">,</span> <span class="mf">175.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Hf&quot;</span><span class="p">,</span> <span class="mf">178.5</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Ta&quot;</span><span class="p">,</span> <span class="mf">180.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">,</span>  <span class="mf">183.9</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Re&quot;</span><span class="p">,</span> <span class="mf">186.2</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Os&quot;</span><span class="p">,</span> <span class="mf">190.2</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Ir&quot;</span><span class="p">,</span> <span class="mf">192.2</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Pt&quot;</span><span class="p">,</span> <span class="mf">195.1</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Au&quot;</span><span class="p">,</span> <span class="mf">197.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Hg&quot;</span><span class="p">,</span> <span class="mf">200.5</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Tl&quot;</span><span class="p">,</span> <span class="mf">204.38</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Pb&quot;</span><span class="p">,</span> <span class="mf">207.2</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Bi&quot;</span><span class="p">,</span> <span class="mf">209.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Po&quot;</span><span class="p">,</span> <span class="mf">209.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;At&quot;</span><span class="p">,</span> <span class="mf">210.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Rn&quot;</span><span class="p">,</span> <span class="mf">222.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Fr&quot;</span><span class="p">,</span> <span class="mf">223.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ra&quot;</span><span class="p">,</span> <span class="mf">226.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Ac&quot;</span><span class="p">,</span> <span class="mf">227.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Th&quot;</span><span class="p">,</span> <span class="mf">232.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Pa&quot;</span><span class="p">,</span> <span class="mf">231.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span>  <span class="mf">238.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Np&quot;</span><span class="p">,</span> <span class="mf">237.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Pu&quot;</span><span class="p">,</span> <span class="mf">244.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Am&quot;</span><span class="p">,</span> <span class="mf">243.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Cm&quot;</span><span class="p">,</span> <span class="mf">247.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Bk&quot;</span><span class="p">,</span> <span class="mf">247.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Cf&quot;</span><span class="p">,</span> <span class="mf">251.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Es&quot;</span><span class="p">,</span> <span class="mf">252.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Fm&quot;</span><span class="p">,</span> <span class="mf">257.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Md&quot;</span><span class="p">,</span> <span class="mf">258.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;No&quot;</span><span class="p">,</span> <span class="mf">259.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Lr&quot;</span><span class="p">,</span> <span class="mf">262.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Rf&quot;</span><span class="p">,</span> <span class="mf">267.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Db&quot;</span><span class="p">,</span> <span class="mf">268.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Sg&quot;</span><span class="p">,</span> <span class="mf">269.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Bh&quot;</span><span class="p">,</span> <span class="mf">270.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Hs&quot;</span><span class="p">,</span> <span class="mf">277.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Mt&quot;</span><span class="p">,</span> <span class="mf">278.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Ds&quot;</span><span class="p">,</span> <span class="mf">281.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Rg&quot;</span><span class="p">,</span> <span class="mf">282.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Cn&quot;</span><span class="p">,</span> <span class="mf">285.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Nh&quot;</span><span class="p">,</span> <span class="mf">286.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Fl&quot;</span><span class="p">,</span> <span class="mf">289.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Mc&quot;</span><span class="p">,</span> <span class="mf">289.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Lv&quot;</span><span class="p">,</span> <span class="mf">293.0</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Ts&quot;</span><span class="p">,</span> <span class="mf">294.0</span><span class="p">),</span>  <span class="p">(</span><span class="s2">&quot;Og&quot;</span><span class="p">,</span> <span class="mf">294.0</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># The width, in angstroms, of the margin around the bounding box</span>
<span class="n">DEFAULT_BOUNDARY_MARGIN</span> <span class="o">=</span> <span class="mf">0.8</span>

<span class="n">DEFAULT_XYZ_COMMENT</span> <span class="o">=</span> <span class="s2">&quot;generated with nme&quot;</span>

<span class="c1">## WRAPPER FUNCTIONS FOR INTERACTING WITH ELEMENTS ARRAY #######################</span>

<div class="viewcode-block" id="symbol_to_atomic_number"><a class="viewcode-back" href="../../api.html#nme.nme.symbol_to_atomic_number">[docs]</a><span class="k">def</span> <span class="nf">symbol_to_atomic_number</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert an element&#39;s symbol to its atomic number &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ELEMENTS</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ELEMENTS</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
            <span class="k">return</span> <span class="n">i</span></div>

<div class="viewcode-block" id="symbol_to_atomic_mass"><a class="viewcode-back" href="../../api.html#nme.nme.symbol_to_atomic_mass">[docs]</a><span class="k">def</span> <span class="nf">symbol_to_atomic_mass</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert an element&#39;s symbol to its atomic mass &quot;&quot;&quot;</span>

    <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">ELEMENTS</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">first</span><span class="p">):</span>
            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">symbol</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
            <span class="k">return</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="atomic_number_to_symbol"><a class="viewcode-back" href="../../api.html#nme.nme.atomic_number_to_symbol">[docs]</a><span class="k">def</span> <span class="nf">atomic_number_to_symbol</span><span class="p">(</span><span class="n">atomic_number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert an atomic number to a symbol &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">ELEMENTS</span><span class="p">[</span><span class="n">atomic_number</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="atomic_number_to_atomic_mass"><a class="viewcode-back" href="../../api.html#nme.nme.atomic_number_to_atomic_mass">[docs]</a><span class="k">def</span> <span class="nf">atomic_number_to_atomic_mass</span><span class="p">(</span><span class="n">atomic_number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert an atomic number to that element&#39;s atomic mass &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">ELEMENTS</span><span class="p">[</span><span class="n">atomic_number</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="atomic_mass_to_atomic_number"><a class="viewcode-back" href="../../api.html#nme.nme.atomic_mass_to_atomic_number">[docs]</a><span class="k">def</span> <span class="nf">atomic_mass_to_atomic_number</span><span class="p">(</span><span class="n">atomic_mass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert an atomic mass to an atomic number by guessing what the element</span>
<span class="sd">    is by finding the element with the closest atomic mass &quot;&quot;&quot;</span>

    <span class="c1"># return first item of sorted list of tuples where the first index is the</span>
    <span class="c1"># atomic number and the second index is the absolute value of the</span>
    <span class="c1"># difference in that element&#39;s atomic mass and the provided atomic mass</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ELEMENTS</span><span class="p">)),</span>
            <span class="p">[</span>
                <span class="nb">abs</span><span class="p">(</span><span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">atomic_mass</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span> <span class="mf">1e100</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">ELEMENTS</span>
            <span class="p">]</span>
        <span class="p">),</span>
        <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="atomic_mass_to_symbol"><a class="viewcode-back" href="../../api.html#nme.nme.atomic_mass_to_symbol">[docs]</a><span class="k">def</span> <span class="nf">atomic_mass_to_symbol</span><span class="p">(</span><span class="n">atomic_mass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Convert an atomic mass to a symbol &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">atomic_number_to_symbol</span><span class="p">(</span>
        <span class="n">atomic_mass_to_atomic_number</span><span class="p">(</span><span class="n">atomic_mass</span><span class="p">)</span>
    <span class="p">)</span></div>

<span class="c1">################################################################################</span>

<div class="viewcode-block" id="Atom"><a class="viewcode-back" href="../../api.html#nme.nme.Atom">[docs]</a><span class="k">class</span> <span class="nc">Atom</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize an :class:`Atom`. This is the fundamental object of</span>
<span class="sd">        ``nme``.</span>

<span class="sd">        :param int element: The atomic number of the element</span>
<span class="sd">        :param xyz: |xyz| corresponding to the atom&#39;s coordinates</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Dict-like storage of values</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="Molecule"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule">[docs]</a><span class="k">class</span> <span class="nc">Molecule</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize a :class:`Molecule`. A :class:`Molecule` acts a</span>
<span class="sd">        container for :class:`Atom` objects and can be used to manipulate</span>
<span class="sd">        groups of atoms or write a group of atoms to the disk.</span>

<span class="sd">        :param list atoms: (optional) A list of :class:`Atom` objects. If no</span>
<span class="sd">            atoms are provied then an empty molecule is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">atoms</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Molecule.copy"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a copy of this molecule</span>

<span class="sd">        :return: A copy of this molecule</span>
<span class="sd">        :rtype: :class:`Molecule`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Molecule.append"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Append atoms or molecules to the atoms array</span>

<span class="sd">        :param other: An :class:`Atom`, :class:`Molecule`, or a list of atoms</span>
<span class="sd">            and molecules</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">object_</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span> <span class="o">==</span> <span class="n">Atom</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span> <span class="o">==</span> <span class="n">Molecule</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">+=</span> <span class="n">object_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">atoms</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Object of type </span><span class="si">%s</span><span class="s2"> cannot be appended to Molecule&quot;</span>
                    <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="Molecule.offset"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.offset">[docs]</a>    <span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Offset the current molecule</span>

<span class="sd">        :param offset: |xyz| corresponding to the translation that should be</span>
<span class="sd">            applied to all of the molecule&#39;s atoms</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">np_offset</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">np_offset</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">casting</span> <span class="o">=</span> <span class="s2">&quot;unsafe&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Molecule.move_to"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.move_to">[docs]</a>    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Move the molecule such that its centroid is at the desired position</span>

<span class="sd">        :param xyz: |xyz|, corresponding to the location that the molecule</span>
<span class="sd">            should be moved to</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span><span class="p">)</span></div>

<div class="viewcode-block" id="Molecule.rotate"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">degrees</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Rotate the molecule about its centroid in 3D space</span>

<span class="sd">        :param float theta: The angle to rotate the molecule around its X axis</span>
<span class="sd">        :param float phi: The angle to rotate the molecule around its Y axis</span>
<span class="sd">        :param float psi: The angle to rotate the molecule around its Z axis</span>
<span class="sd">        :param bool degrees: (optional) If True, the angles given are assumed</span>
<span class="sd">            to be in degrees and will be converted to radians before being used</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># https://www.siggraph.org/education/materials/HyperGraph/modeling/mod_tran/3drota.htm</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">degrees</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>

        <span class="n">rx</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">ry</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">rz</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span>

        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
            <span class="n">current_centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

            <span class="n">transpose</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span> <span class="o">=</span> <span class="p">(</span><span class="n">rx</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">transpose</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">current_centroid</span><span class="p">)</span></div>

<div class="viewcode-block" id="Molecule.find_bonds"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.find_bonds">[docs]</a>    <span class="k">def</span> <span class="nf">find_bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bond_radius</span> <span class="o">=</span> <span class="n">DEFAULT_BOND_RADIUS</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Find bonds between molecules</span>

<span class="sd">        :param float bond_radius: (optional) The distance, in angstroms,</span>
<span class="sd">            between two atoms under which a bond will be assumed</span>
<span class="sd">        :return: A two-dimensional array of atoms where each pair of atoms</span>
<span class="sd">            represents a bond</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">all_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;computing euclidean distance matrix for </span><span class="si">%d</span><span class="s2"> atoms&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">cdist</span><span class="p">(</span>
            <span class="n">all_coords</span><span class="p">,</span> <span class="n">all_coords</span><span class="p">,</span> <span class="s2">&quot;euclidean&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span>
                <span class="p">(</span><span class="n">distances</span> <span class="o">&lt;</span> <span class="n">bond_radius</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">distances</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span></div>

<div class="viewcode-block" id="Molecule.write_xyz"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.write_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">write_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">DEFAULT_XYZ_COMMENT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Write the current molecule to an XYZ file</span>

<span class="sd">        :param str filename: The path that the XYZ data should be written to</span>
<span class="sd">        :param str comment: (optional) A comment to include in the XYZ file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">),</span> <span class="n">comment</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="p">))</span></div>

<div class="viewcode-block" id="Molecule.write_lammps"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.write_lammps">[docs]</a>    <span class="k">def</span> <span class="nf">write_lammps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Syntactic sugar: see :meth:`nme.nme.write_lammps` &quot;&quot;&quot;</span>

        <span class="n">write_lammps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Molecule.bbox_intersects"><a class="viewcode-back" href="../../api.html#nme.nme.Molecule.bbox_intersects">[docs]</a>    <span class="k">def</span> <span class="nf">bbox_intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">molecule</span><span class="p">,</span> <span class="n">padding</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Test whether the bounding box of the current molecule intersects</span>
<span class="sd">        the bounding box of another molecule</span>

<span class="sd">        :param Molecule molecule: The other molecule</span>
<span class="sd">        :param float padding: (optional) A number to pad the bounding boxes by</span>
<span class="sd">            to increase their size</span>
<span class="sd">        :return: True if the bounding box of this molecule intersects the</span>
<span class="sd">            bounding box of another molecule; False otherwise.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bbox_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span>
        <span class="n">bbox_other</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">bbox</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">padding</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">padding_np</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">padding</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">bbox_self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">padding_np</span>
            <span class="n">bbox_self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">padding_np</span>
            <span class="n">bbox_other</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">padding_np</span>
            <span class="n">bbox_other</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">padding_np</span>

        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">(</span>
            <span class="p">(</span><span class="n">bbox_self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bbox_other</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">bbox_self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bbox_other</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">)],</span>
            <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">)]</span>
        <span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_bonds</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>

    <span class="c1"># Iteration procedures</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_iter_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_iter_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_iter_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_iter_index</span><span class="p">]</span>

    <span class="c1"># Dict-like storage of values</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Syntactic sugar</span>
    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span>
        <span class="n">new</span> <span class="o">+=</span> <span class="bp">self</span>
        <span class="n">new</span> <span class="o">+=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Workspace"><a class="viewcode-back" href="../../api.html#nme.nme.Workspace">[docs]</a><span class="k">class</span> <span class="nc">Workspace</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize a :class:`Workspace`. A Workspace is a container for</span>
<span class="sd">        :class:`Atom`s and :class:`Molecule`s. The primary purpose of a</span>
<span class="sd">        Workspace is to facilitate writing multiple atoms and molecules to a</span>
<span class="sd">        single output file. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Workspace.append"><a class="viewcode-back" href="../../api.html#nme.nme.Workspace.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Append atoms or molecules to the workspace</span>

<span class="sd">        :param object_: An `Atom` or `Molecule`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span> <span class="o">==</span> <span class="n">Molecule</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span> <span class="o">==</span> <span class="n">Atom</span><span class="p">):</span>
            <span class="n">new_molecule</span> <span class="o">=</span> <span class="n">Molecule</span><span class="p">()</span>
            <span class="n">new_molecule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_molecule</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Object of type </span><span class="si">%s</span><span class="s2"> cannot be appended to Workspace&quot;</span>
                <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">object_</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Workspace.write_xyz"><a class="viewcode-back" href="../../api.html#nme.nme.Workspace.write_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">write_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">DEFAULT_XYZ_COMMENT</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Write the current workspace to an XYZ file</span>

<span class="sd">        :param str filename: The path that the XYZ data should be written to</span>
<span class="sd">        :param str comment: (optional) A comment to include in the XYZ file</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">sum</span><span class="p">([</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span>
                <span class="p">]),</span>
                <span class="n">comment</span>
            <span class="p">))</span>
            <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="se">\t</span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="p">))</span></div>

<div class="viewcode-block" id="Workspace.write_lammps"><a class="viewcode-back" href="../../api.html#nme.nme.Workspace.write_lammps">[docs]</a>    <span class="k">def</span> <span class="nf">write_lammps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Syntactic sugar: see :meth:`nme.nme.write_lammps`&quot;&quot;&quot;</span>

        <span class="n">write_lammps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecules</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">all_atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span><span class="p">:</span>
            <span class="n">all_atoms</span> <span class="o">+=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span>
        <span class="n">all_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">]</span>
        <span class="n">all_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">]</span>
        <span class="n">all_z</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">all_x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_y</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">all_z</span><span class="p">)]),</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">all_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_z</span><span class="p">)])</span>
        <span class="p">]</span>

    <span class="c1"># Dict-like storage of values</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Iteration procedures</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule_iter_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule_iter_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule_iter_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">molecules</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">StopIteration</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">molecule_iter_index</span><span class="p">]</span>

    <span class="c1"># Syntactic sugar</span>
    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">()</span>
        <span class="n">new</span> <span class="o">+=</span> <span class="bp">self</span>
        <span class="n">new</span> <span class="o">+=</span> <span class="n">other</span>
        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="read_xyz"><a class="viewcode-back" href="../../api.html#nme.nme.read_xyz">[docs]</a><span class="k">def</span> <span class="nf">read_xyz</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Read a .xyz file into an array of atoms</span>

<span class="sd">    :param str filepath: The path of the xyz file</span>
<span class="sd">    :return: A :class:`Molecule` object containing the atoms in the .xyz file</span>
<span class="sd">    :rtype: Molecule</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">atomic_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">atomic_number</span> <span class="o">=</span> <span class="n">symbol_to_atomic_number</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">Atom</span><span class="p">(</span>
                        <span class="n">atomic_number</span><span class="p">,</span> <span class="c1"># atomic number</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                        <span class="p">])</span> <span class="c1"># coordinates</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">found </span><span class="si">%d</span><span class="s2"> atoms&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Molecule</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span></div>

<div class="viewcode-block" id="write_lammps"><a class="viewcode-back" href="../../api.html#nme.nme.write_lammps">[docs]</a><span class="k">def</span> <span class="nf">write_lammps</span><span class="p">(</span><span class="n">molecules</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">bbox</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">boundary_margin</span> <span class="o">=</span> <span class="n">DEFAULT_BOUNDARY_MARGIN</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Write the given molecules to a LAMMPS data file</span>

<span class="sd">    :param molecules: A molecule or array of molecules to be written</span>
<span class="sd">    :param filename: The path that the LAMMPS data should be written to</span>
<span class="sd">    :param bbox: (optional) The bounding box of the simulation area, specified</span>
<span class="sd">        as a pair of cartesian coordinates corresponding to the minimum</span>
<span class="sd">        coordinates and the maximum coordinates (e.g. [ [0, 0, 0], [1, 1, 1] ])</span>
<span class="sd">    :param boundary_margin: (optional) If a bounding box is not supplied,</span>
<span class="sd">        compute a bounding box automatically by padding the area taken up by</span>
<span class="sd">        the molecules by this many atoms</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">molecules</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">molecules</span> <span class="o">=</span> <span class="p">[</span><span class="n">molecules</span><span class="p">]</span>

    <span class="n">all_atoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
        <span class="n">all_atoms</span> <span class="o">+=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span>

    <span class="n">unique_elements</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="nb">sorted</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">([</span>
                <span class="n">atom</span><span class="o">.</span><span class="n">element</span>
                <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">all_atoms</span>
            <span class="p">])</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">atom_element_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span>
            <span class="n">unique_elements</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_elements</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">i_atom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">i_mol</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="c1"># Header</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LAMMPS data file</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Summary</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> atoms</span><span class="se">\n</span><span class="s2">0 bonds</span><span class="se">\n</span><span class="s2">0 angles</span><span class="se">\n</span><span class="s2">0 dihedrals</span><span class="se">\n</span><span class="s2">0 impropers</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_atoms</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Summary - types</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> atom types</span><span class="se">\n</span><span class="s2">0 bond types</span><span class="se">\n</span><span class="s2">0 angle types</span><span class="se">\n</span><span class="s2">0 dihedral types</span><span class="se">\n</span><span class="s2">0 improper types</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_elements</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Compute bbox if necessary</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bbox</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">all_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">]</span>
            <span class="n">all_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">]</span>
            <span class="n">all_z</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">]</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span>
                    <span class="nb">min</span><span class="p">(</span><span class="n">all_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">boundary_margin</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span><span class="n">all_y</span><span class="p">)</span> <span class="o">-</span> <span class="n">boundary_margin</span><span class="p">,</span>
                    <span class="nb">min</span><span class="p">(</span><span class="n">all_z</span><span class="p">)</span> <span class="o">-</span> <span class="n">boundary_margin</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">all_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">boundary_margin</span><span class="p">,</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">all_y</span><span class="p">)</span> <span class="o">+</span> <span class="n">boundary_margin</span><span class="p">,</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">all_z</span><span class="p">)</span> <span class="o">+</span> <span class="n">boundary_margin</span>
                <span class="p">]</span>
            <span class="p">]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%0.6f</span><span class="s2"> </span><span class="si">%0.6f</span><span class="s2"> xlo xhi</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%0.6f</span><span class="s2"> </span><span class="si">%0.6f</span><span class="s2"> ylo yhi</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%0.6f</span><span class="s2"> </span><span class="si">%0.6f</span><span class="s2"> zlo zhi</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>

        <span class="c1"># Masses of involved elements</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Masses</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">atom_element_map</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">atom_element_map</span><span class="p">[</span><span class="n">element</span><span class="p">],</span> <span class="n">ELEMENTS</span><span class="p">[</span><span class="n">element</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">))</span>

        <span class="c1"># Individual atoms</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Atoms</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">molecules</span><span class="p">:</span>
            <span class="n">i_mol</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">molecule</span><span class="p">:</span>
                <span class="n">i_atom</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">xyz</span>
                <span class="n">atom_number</span> <span class="o">=</span> <span class="n">atom_element_map</span><span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%d</span><span class="se">\t</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%0.6f</span><span class="se">\t</span><span class="si">%0.6f</span><span class="se">\t</span><span class="si">%0.6f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">i_atom</span><span class="p">,</span> <span class="n">i_mol</span><span class="p">,</span> <span class="n">atom_number</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="p">))</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, NICE Lab at Northeastern University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>